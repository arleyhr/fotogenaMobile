{"version":3,"names":[],"mappings":"","sources":["app-module.js"],"sourcesContent":["(function () {\r\n  'use strict';\r\n\r\n  /* @ngdoc object\r\n   * @name fotogena\r\n   * @description\r\n   *\r\n   */\r\n\r\n    function AppCtrl(urlBase, $rootScope, $ionicSideMenuDelegate, $location, $state, $filter, $ionicScrollDelegate, LoginService, ProfileService, $ionicPopup) {\r\n\r\n      var app = this;\r\n\r\n      app.tempMessageID = ''\r\n\r\n      $rootScope.$on('notification', function(data){\r\n        alert(JSON.stringify(data))\r\n      })\r\n\r\n\r\n      //Toggle Menus\r\n      app.toggleMenu = function (a) {\r\n\r\n        if (a === 'right') $ionicSideMenuDelegate.toggleLeft(true);\r\n\r\n        else if (a === 'left') $ionicSideMenuDelegate.toggleRight(true);\r\n\r\n        else console.log('Â¿sidemenu?');\r\n\r\n      };\r\n\r\n      //Handle connect || disconnect\r\n      $rootScope.notificator.on('notific1', function (a) {\r\n\r\n        switch (a.type) {\r\n\r\n          case 46: //Connected\r\n\r\n            var desconectado = $filter('filter')($rootScope.conectados, { us: parseInt(a.us) }, true)[0];\r\n\r\n            var index = $rootScope.conectados.indexOf(desconectado);\r\n\r\n            $rootScope.conectados.splice(index, 1);\r\n\r\n            break;\r\n\r\n          case 47: //Disconnect\r\n\r\n            var data = a;\r\n\r\n            var conectado = $filter('filter')($rootScope.conectados, { us: data.us });\r\n\r\n            $rootScope.conectados.push(data);\r\n\r\n            break;\r\n        }\r\n      });\r\n\r\n      $rootScope.goToChat = function (conectado) {\r\n\r\n        console.log(conectado)\r\n\r\n        $ionicSideMenuDelegate.toggleRight();\r\n\r\n        setTimeout(function () {\r\n          $state.go('chat', { nick: conectado.nick, id_user: conectado.us, iChat: conectado.iChat });\r\n        }, 200);\r\n\r\n      };\r\n\r\n      $rootScope.listenMsg = function () {\r\n\r\n        console.log('listening...', $rootScope.auth_user.nick)\r\n\r\n        // $rootScope.chatificator.on('chatJoin:'+$rootScope.auth_user.nick, function(data){\r\n        // \tconsole.log(data, 'uyagefbrf')\r\n        // \t$rootScope.chatificator.emit('joinChat', data)\r\n        // \t// console.log(data)\r\n        //   $ionicScrollDelegate.$getByHandle('chatScroll').scrollBottom(true);\r\n        // })\r\n\r\n        $rootScope.chatificator.on('readMsg', function (msg) {\r\nconsole.log(msg)\r\n\r\n\r\n\r\n          if (msg.id == app.tempMessageID) return\r\n\r\n          $rootScope.tempChatImages[msg.chat] = msg.pDir\r\n\r\n          if ($rootScope.messages[msg.chat]){\r\n\r\n            $rootScope.messages[msg.chat].push(msg);\r\n\r\n            app.tempMessageID = msg.id\r\n\r\n\r\n          }\r\n\r\n          else{\r\n            $rootScope.messages[msg.chat] = msg;\r\n\r\n            app.tempMessageID = msg.id\r\n\r\n          }\r\n\r\n\r\n          $ionicScrollDelegate.$getByHandle('chatScroll').scrollBottom(true);\r\n        });\r\n      };\r\n\r\n    }\r\n\r\n    function RunApp ($ionicPlatform, $rootScope, $http, $state, urlBase, ProfileService, SocketFactory, LoginService ) {\r\n\r\n        \r\n\r\n\r\n        \r\n\r\n\r\n\r\n\r\n        $rootScope.messages = [];\r\n\r\n        $rootScope.tempChatImages = [];\r\n\r\n        $rootScope.URL = urlBase;\r\n\r\n        $rootScope.chatificator = new SocketFactory(urlBase+'/HistChat');\r\n\r\n        $rootScope.notificator = new SocketFactory(urlBase+'/notific');\r\n\r\n        $rootScope.logged = false;\r\n\r\n        if (localStorage['cookie'] && localStorage['auth_user']) {\r\n\r\n          ProfileService.getProfileData( JSON.parse(localStorage['auth_user']).nick,\r\n\r\n            function(data){\r\n\r\n            $rootScope.auth_user = data;\r\n\r\n            $rootScope.auth_user.cod = '5487' + data.cod;\r\n\r\n            localStorage['auth_user'] = JSON.stringify(data);\r\n\r\n            LoginService.afterLogged();\r\n\r\n          })\r\n        }else{\r\n          console.log('Isn\\'t logged')\r\n        }\r\n\r\n        $rootScope.$on('$stateChangeStart', function (event, toState, toParams, fromState, fromParams) {\r\n\r\n          var state = toState.name;\r\n\r\n        });\r\n\r\n        $ionicPlatform.ready(function () {\r\n\r\n           \r\n\r\n\r\n           if (window.plugins && window.plugins.OneSignal){\r\n            window.plugins.OneSignal.init(\"7c18cf30-04c3-459b-9fb8-df42b192d5e0\",\r\n                                   {googleProjectNumber: \"78551362945\"},\r\n                                   function(data){\r\n\r\n                                      $rootScope.$broadcast('notification', data)\r\n\r\n                                   });\r\n            \r\n              window.plugins.OneSignal.sendTag(\"developer\", \"true\")\r\n\r\n            }\r\n\r\n          if (window.cordova && window.cordova.plugins.Keyboard) cordova.plugins.Keyboard.hideKeyboardAccessoryBar(true);\r\n\r\n          if (window.StatusBar) StatusBar.styleDefault();\r\n\r\n        });\r\n\r\n    }\r\n\r\n\r\n    angular\r\n    .module('fotogena', [\r\n      'ngMaterial',\r\n      'ui.router',\r\n      'ionic',\r\n      'home',\r\n      'login',\r\n      'signup',\r\n      'myProfile',\r\n      'chat',\r\n      'profile'\r\n    ])\r\n    .controller('AppCtrl', AppCtrl)\r\n    .run(RunApp);\r\n\r\n\r\n}());\r\n"],"file":"app-module.js","sourceRoot":"/source/"}