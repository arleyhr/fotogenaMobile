{"version":3,"names":[],"mappings":"","sources":["login/login-factory.js"],"sourcesContent":["(function () {\r\n  'use strict';\r\n\r\n  /**\r\n   * @ngdoc service\r\n   * @name login.factory:Login\r\n   *\r\n   * @description\r\n   *\r\n   */\r\n  angular\r\n    .module('login')\r\n    .factory('LoginService', Login);\r\n\r\n  function Login($rootScope, $state, $http, urlBase, ChatService, $filter) {\r\n\r\n    var self = this;\r\n\r\n    this.getSession = function(){\r\n\r\n      return $http.get( urlBase + '/getSession/');\r\n\r\n    }\r\n\r\n    this.afterLogged = function () {\r\n\r\n\r\n      $rootScope.listenMsg();\r\n\r\n\r\n        $rootScope.notificator.emit('enterRoom', { session: localStorage['cookie'] });\r\n\r\n\r\n\r\n        $rootScope.chatificator.emit('inMobile', {\r\n\r\n          token: localStorage['cookie']\r\n\r\n        }, function (data) {\r\n\r\n          if (data.res && data.res == 3) {\r\n\r\n            self.logout();\r\n\r\n            return;\r\n          }\r\n\r\n          $rootScope.conectados =  data;\r\n\r\n          console.log(data)\r\n\r\n          ChatService.openChat(function (chats){\r\n\r\n            $rootScope.openedChats = chats || [];\r\n\r\n            angular.forEach(chats, function (value, key) {\r\n\r\n              var filtered = $filter('filter')($rootScope.conectados, {us: value.user2})[0]\r\n\r\n              if (filtered)\r\n\r\n                $rootScope.conectados[$rootScope.conectados.indexOf(filtered)].iChat = value.chat\r\n\r\n\r\n              // ChatService.openChats(value, function (data){\r\n              //\r\n              //     //\r\n              //\r\n              // })\r\n\r\n            });\r\n\r\n          })\r\n\r\n\r\n        });\r\n\r\n\r\n\r\n        $state.go('profile',{ nick: JSON.parse(localStorage['auth_user']).nick });\r\n    }\r\n\r\n    this.logout = function(){\r\n\r\n      delete localStorage['cookie']\r\n\r\n      $state.go('login')\r\n\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n}());\r\n"],"file":"login/login-factory.js","sourceRoot":"/source/"}